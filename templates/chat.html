<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticio - Chat App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="bg-dark border-right" id="sidebar">
            <div class="sidebar-heading text-center py-4" style="background-color: #910A0A;">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="img-fluid" style="max-width: 150px;">
            </div>
            <div class="list-group list-group-flush">
                <a href="https://ticio.co" class="list-group-item list-group-item-action bg-dark text-light">Home</a>
                <a href="{{ url_for('chat') }}" class="list-group-item list-group-item-action bg-dark text-light">Chat</a>
                <a href="{{ url_for('login') }}" class="list-group-item list-group-item-action bg-dark text-light">Login</a>
                <a href="{{ url_for('signup') }}" class="list-group-item list-group-item-action bg-dark text-light">Sign Up</a>
                <!-- Add more navigation items as needed -->
            </div>
        </div>

        <!-- Page Content -->
        <div id="page-content-wrapper" class="w-100 p-4">
            <div class="container-fluid">
                <div class="chat-container">
                    <div id="messages" class="flex-grow-1 mb-3" style="overflow-y: scroll; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                        <!-- Messages will be appended here -->
                    </div>
                    <form id="messageForm" style="display: flex; align-items: center;">
                        <input type="text" id="messageInput" class="form-control" placeholder="Type a message" required style="flex-grow: 1; margin-right: 10px; border: none; outline: none;">
                        <button type="submit" class="btn" style="background-color: #910A0A; color: white;">Send</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);

        // Handle incoming messages
        socket.on('message', function(data) {
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('message-container', 'response-container');

            const labelElement = document.createElement('div');
            labelElement.classList.add('message-label');
            labelElement.textContent = 'Ticio';

            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'response');
            messageElement.textContent = data;
            messageElement.contentEditable = true;  // Make Ticio's message selectable

            messageContainer.appendChild(labelElement);
            messageContainer.appendChild(messageElement);
            document.getElementById('messages').appendChild(messageContainer);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;

            // Add click event to copy message to clipboard
            messageElement.addEventListener('click', function() {
                const range = document.createRange();
                range.selectNode(messageElement);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);

                try {
                    const successful = document.execCommand('copy');
                    const msg = successful ? 'Copied!' : 'Failed to copy!';
                    console.log(msg);
                } catch (err) {
                    console.error('Error copying text: ', err);
                }

                // Deselect the text
                window.getSelection().removeAllRanges();
            });
        });

        // Handle form submission
        document.getElementById('messageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            socket.send(message);

            // Display the sent message
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('message-container', 'user-container');

            const labelElement = document.createElement('div');
            labelElement.classList.add('message-label');
            labelElement.textContent = 'You';

            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.textContent = message;

            messageContainer.appendChild(labelElement);
            messageContainer.appendChild(messageElement);
            document.getElementById('messages').appendChild(messageContainer);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;

            messageInput.value = '';
        });

        // Handle enter key press
        document.getElementById('messageInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('messageForm').dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>

